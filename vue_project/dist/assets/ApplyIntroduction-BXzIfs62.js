/* empty css             *//* empty css                   *//* empty css            *//* empty css               *//* empty css               *//* empty css              *//* empty css                     *//* empty css                *//* empty css                  *//* empty css                 *//* empty css                     *//* empty css                *//* empty css               */import{b as L,e as P,W as h,X as j,c as v,a as p,f as o,s as m,u as w,N as W,h as Y,w as a,k as G,Q,P as X,R as Z,m as y,p as f,o as i,l as n,B as g,S as K,$ as ee,V as te,E as oe,g as le,O as ae,i as re,F as ne,r as se,j as ie,Y as de,Z as ue,U as pe}from"./index-0MHbT1SH.js";import{T as me,E as fe}from"./index.esm-ChNdF61u.js";const ge={class:"card",style:{"margin-bottom":"5px"}},ce={key:0,class:"card",style:{"margin-bottom":"5px"}},be={class:"card",style:{"margin-bottom":"5px"}},ye={style:{border:"1px solid #ccc",width:"100%"}},_e={class:"dialog-footer",style:{padding:"0 0 0 0"}},Ve={class:"dialog-footer",style:{padding:"0 0 0 0"}},ke={class:"card",style:{"margin-bottom":"5px"}},Ce=["innerHTML"],R="default",$e={__name:"ApplyIntroduction",setup(ve){const E=L(),e=P({user:JSON.parse(localStorage.getItem("code_user")||"{}"),pageNum:1,pageSize:5,total:0,title:null,tableData:[],form:{},formVisible:!1,formVisible2:!1,rules:{title:[{required:!0,message:"请填写请假标题",trigger:"blur"}],content:[{required:!0,message:"请填写请假内容",trigger:"blur"}]},pageTotal:6,content:null,viewVisible:!1,categoryData:[]}),_=h(),S={MENU_CONF:{}};S.MENU_CONF.uploadImage={headers:{token:e.user.token},server:"http://43.143.94.185:9999/files/wang/upload",fieldName:"file"},j(()=>{const r=_.value;r!=null&&r.destroy()});const D=r=>{_.value=r},u=()=>{y.get("/introduction/selectAllStatus",{params:{pageNum:e.pageNum,pageSize:e.pageSize,title:e.title}}).then(r=>{r.code==="200"?(e.tableData=r.data,e.title=r.data.title):f.error("系统异常")})};u();const I=()=>{e.form={},e.formVisible=!0,e.form.status="待审核",e.form.useId=e.user.id},T=()=>{y.post("/introduction/add",e.form).then(r=>{r.code==="200"?(f.success("提交成功， 等待管理员审核"),u(),e.formVisible=!1):f.error(r.msg)})},B=r=>{e.content=r,e.viewVisible=!0},M=()=>{y.put("/introduction/update",e.form).then(r=>{r.code==="200"?(e.formVisible=!1,e.formVisible2=!1,f.success("信息修改成功"),u()):f.error(r.msg)})},x=()=>{e.form.id?M():T()},O=r=>{pe.confirm("您确认要删除数据吗，删除后无法恢复","删除确认",{type:"warning"}).then(t=>{y.delete("/apply/delete/"+r).then(c=>{c.code==="200"?(f.success("删除成功"),console.log("删除成功"),u()):f.error(c.msg)})}).catch(t=>{})},N=r=>{e.form=JSON.parse(JSON.stringify(r)),e.formVisible2=!0};return(r,t)=>{const c=Y,s=G,d=K,V=ee,F=Q,$=ae,b=le,A=ie,q=re,U=oe,k=X,z=ue,H=de,J=Z;return i(),v("div",null,[p("div",null,[p("div",ge,[o(c,{clearable:"",onClear:u,style:{width:"240px"},modelValue:e.title,"onUpdate:modelValue":t[0]||(t[0]=l=>e.title=l),placeholder:"请输入title查询","prefix-icon":w(W)},null,8,["modelValue","prefix-icon"]),o(s,{type:"primary",onClick:u},{default:a(()=>t[13]||(t[13]=[n("查 询")])),_:1}),o(s,{onClick:r.reset},{default:a(()=>t[14]||(t[14]=[n("重 置")])),_:1},8,["onClick"])]),e.user.role==="USER"?(i(),v("div",ce,[o(s,{type:"info",onClick:I},{default:a(()=>t[15]||(t[15]=[n("发布帖子")])),_:1})])):m("",!0)]),p("div",be,[o(F,{data:e.tableData,style:{width:"100%"},onSelectionChange:r.handleSelectionChange,"header-cell-style":{color:"#333",fontSize:"17px",backgroundColor:"#eaf4ff"}},{default:a(()=>[o(d,{type:"selection",width:"55"}),o(d,{label:"攻略标题",prop:"title"}),o(d,{prop:"content",label:"攻略内容"},{default:a(l=>[o(s,{onClick:C=>B(l.row.content)},{default:a(()=>t[16]||(t[16]=[n("点击查看")])),_:2},1032,["onClick"])]),_:1}),e.user.role==="ADMIN"?(i(),g(d,{key:0,prop:"userName",label:"请假人"})):m("",!0),o(d,{prop:"categoryTitle",label:"攻略分类"}),o(d,{prop:"time",label:"发布时间"}),o(d,{prop:"status",label:"审核状态"},{default:a(l=>[l.row.status==="待审核"?(i(),g(V,{key:0,type:"warning"},{default:a(()=>t[17]||(t[17]=[n("待审核")])),_:1})):m("",!0),l.row.status==="审核拒绝"?(i(),g(V,{key:1,type:"danger"},{default:a(()=>t[18]||(t[18]=[n("审核拒绝")])),_:1})):m("",!0),l.row.status==="审核通过"?(i(),g(V,{key:2,type:"success"},{default:a(()=>t[19]||(t[19]=[n("审核通过")])),_:1})):m("",!0)]),_:1}),o(d,{prop:"reason",label:"审核说明"}),o(d,{label:"操作",width:"100"},te({_:2},[e.user.role==="USER"?{name:"default",fn:a(l=>[o(s,{disabled:l.row.status==="审核拒绝",circle:"",icon:"Edit",type:"primary",onClick:C=>N(l.row)},null,8,["disabled","onClick"]),o(s,{circle:"",icon:"Delete",type:"danger",onClick:C=>O(l.row.id)},null,8,["onClick"])]),key:"0"}:void 0,e.user.role==="ADMIN"?{name:"default",fn:a(l=>[o(s,{type:"primary",onClick:C=>N(l.row)},{default:a(()=>t[20]||(t[20]=[n("审核")])),_:2},1032,["onClick"])]),key:"1"}:void 0]),1024)]),_:1},8,["data","onSelectionChange"])]),o(k,{ref_key:"formRef",ref:E,modelValue:e.formVisible,"onUpdate:modelValue":t[5]||(t[5]=l=>e.formVisible=l),title:"攻略信息",width:"60%","destroy-on-close":""},{footer:a(()=>[p("div",_e,[o(s,{onClick:t[4]||(t[4]=l=>e.formVisible=!1)},{default:a(()=>t[22]||(t[22]=[n("取消")])),_:1}),o(s,{type:"primary",onClick:x},{default:a(()=>t[23]||(t[23]=[n("确认")])),_:1})])]),default:a(()=>[e.user.role==="USER"?(i(),g(U,{key:0,"label-width":"80px",style:{padding:"20px 30px 0 0"},model:e.form},{default:a(()=>[o(b,{prop:"avatar",label:"攻略图片"},{default:a(()=>[o($,{action:"http://43.143.94.185:9999/files/upload",headers:{token:e.user.token},"on-success":r.handleFileSuccess,"list-type":"picture"},{default:a(()=>[o(s,{type:"primary"},{default:a(()=>t[21]||(t[21]=[n("上传头像")])),_:1})]),_:1},8,["headers","on-success"])]),_:1}),o(b,{label:"攻略标题",prop:"title"},{default:a(()=>[o(c,{placeholder:"请输入攻略标题",modelValue:e.form.title,"onUpdate:modelValue":t[1]||(t[1]=l=>e.form.title=l),autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(b,{label:"攻略标题",prop:"title"},{default:a(()=>[o(q,{modelValue:e.form.categoryId,"onUpdate:modelValue":t[2]||(t[2]=l=>e.form.categoryId=l),placeholder:"请选择攻略分类",style:{width:"30%"}},{default:a(()=>[(i(!0),v(ne,null,se(e.categoryData,l=>(i(),g(A,{key:l.id,label:l.title,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(b,{label:"攻略内容",prop:"content"},{default:a(()=>[p("div",ye,[o(w(me),{style:{"border-bottom":"1px solid #ccc"},editor:_.value,mode:R},null,8,["editor"]),o(w(fe),{style:{height:"250px",overflow:"hidden"},modelValue:e.form.content,"onUpdate:modelValue":t[3]||(t[3]=l=>e.form.content=l),mode:R,defaultConfig:S,onOnCreated:D},null,8,["modelValue"])])]),_:1})]),_:1},8,["model"])):m("",!0)]),_:1},8,["modelValue"]),o(k,{modelValue:e.formVisible2,"onUpdate:modelValue":t[9]||(t[9]=l=>e.formVisible2=l),title:"请假信息",width:"500","destroy-on-close":""},{footer:a(()=>[p("div",Ve,[o(s,{onClick:t[8]||(t[8]=l=>e.formVisible=!1)},{default:a(()=>t[24]||(t[24]=[n("取消")])),_:1}),o(s,{type:"primary",onClick:x},{default:a(()=>t[25]||(t[25]=[n("确认")])),_:1})])]),default:a(()=>[o(U,{ref_key:"formRef",ref:E,"label-width":"90px",style:{padding:"20px 30px 0 0"},model:e.form},{default:a(()=>[o(b,{label:"审核状态",prop:"status"},{default:a(()=>[o(H,{modelValue:e.form.status,"onUpdate:modelValue":t[6]||(t[6]=l=>e.form.status=l)},{default:a(()=>[o(z,{label:"审核通过",value:"审核通过"}),o(z,{label:"审核不通过",value:"审核拒绝"})]),_:1},8,["modelValue"])]),_:1}),e.form.status==="审核拒绝"?(i(),g(b,{key:0,label:"WHY不通过",prop:"reason"},{default:a(()=>[o(c,{modelValue:e.form.reason,"onUpdate:modelValue":t[7]||(t[7]=l=>e.form.reason=l),autocomplete:"off",placeholder:"请输入不通过原因"},null,8,["modelValue"])]),_:1})):m("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"]),p("div",ke,[o(J,{"current-page":e.pageNum,"onUpdate:currentPage":t[10]||(t[10]=l=>e.pageNum=l),"page-size":e.pageSize,"onUpdate:pageSize":t[11]||(t[11]=l=>e.pageSize=l),total:e.total,"page-sizes":[5,10,20],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:u,onSizeChange:u},null,8,["current-page","page-size","total"])]),o(k,{modelValue:e.viewVisible,"onUpdate:modelValue":t[12]||(t[12]=l=>e.viewVisible=l),title:"攻略信息",width:"60%","destroy-on-close":"",top:"20px"},{default:a(()=>[p("div",{ref:"dialogContent",innerHTML:e.content,style:{padding:"0 20px"}},null,8,Ce)]),_:1},8,["modelValue"])])}}};export{$e as default};
