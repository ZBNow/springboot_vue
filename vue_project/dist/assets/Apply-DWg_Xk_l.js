/* empty css             *//* empty css                   *//* empty css            *//* empty css               *//* empty css               *//* empty css              *//* empty css                     *//* empty css                *//* empty css                     *//* empty css                *//* empty css                  *//* empty css                     *//* empty css               */import{b as M,e as T,c as C,a as c,f as o,s as i,u as $,N as F,h as P,w as a,k as q,P as J,Q as O,R as h,F as j,m as y,p as g,o as n,l as d,E as G,B as f,g as Q,Y,Z,S as H,T as K,$ as L,V as W,U as X}from"./index-0MHbT1SH.js";const ee={class:"card",style:{"margin-bottom":"5px"}},te={key:0,class:"card",style:{"margin-bottom":"5px"}},le={class:"dialog-footer",style:{padding:"0 0 0 0"}},oe={class:"card",style:{"margin-bottom":"5px"}},ae={class:"card",style:{"margin-bottom":"5px"}},ke={__name:"Apply",setup(re){const _=M(),e=T({user:JSON.parse(localStorage.getItem("code_user")||"{}"),pageNum:1,pageSize:5,total:0,title:null,tableData:[],form:{},formVisible:!1,rules:{title:[{required:!0,message:"请填写请假标题",trigger:"blur"}],content:[{required:!0,message:"请填写请假内容",trigger:"blur"}]}}),u=()=>{y.get("apply/selectPage",{params:{pageNum:e.pageNum,pageSize:e.pageSize,title:e.title}}).then(r=>{var t,s;r.code==="200"?(e.tableData=(t=r.data)==null?void 0:t.list,e.total=(s=r.data)==null?void 0:s.total):g.error(r.msg)})};u();const E=()=>{e.form={},e.formVisible=!0,e.form.status="待审核",e.form.useId=e.user.id},S=()=>{y.post("/apply/add",e.form).then(r=>{r.code==="200"?(g.success("提交成功， 等待管理员审核"),u(),e.formVisible=!1):g.error(r.msg)})},x=()=>{_.value.validate(r=>{r&&y.put("/apply/update",e.form).then(t=>{t.code==="200"?(e.formVisible=!1,g.success("信息修改成功"),u()):g.error(t.msg)})})},N=()=>{_.value.validate(r=>{r&&(e.form.id?x():S())})},U=r=>{X.confirm("您确认要删除数据吗，删除后无法恢复","删除确认",{type:"warning"}).then(t=>{y.delete("/apply/delete/"+r).then(s=>{s.code==="200"?(g.success("删除成功"),console.log("删除成功"),u()):g.error(s.msg)})}).catch(t=>{})},k=r=>{e.form=JSON.parse(JSON.stringify(r)),e.formVisible=!0};return(r,t)=>{const s=P,p=q,b=Q,w=Z,z=Y,D=G,R=J,m=H,B=K,V=L,I=O,A=h;return n(),C(j,null,[c("div",null,[c("div",ee,[o(s,{clearable:"",onClear:u,style:{width:"240px"},modelValue:e.title,"onUpdate:modelValue":t[0]||(t[0]=l=>e.title=l),placeholder:"请输入title查询","prefix-icon":$(F)},null,8,["modelValue","prefix-icon"]),o(p,{type:"primary",onClick:u},{default:a(()=>t[9]||(t[9]=[d("查 询")])),_:1}),o(p,{onClick:r.reset},{default:a(()=>t[10]||(t[10]=[d("重 置")])),_:1},8,["onClick"])]),e.user.role==="USER"?(n(),C("div",te,[o(p,{type:"info",onClick:E},{default:a(()=>t[11]||(t[11]=[d("发布帖子")])),_:1})])):i("",!0)]),o(R,{modelValue:e.formVisible,"onUpdate:modelValue":t[6]||(t[6]=l=>e.formVisible=l),title:"请假信息",width:"500","destroy-on-close":""},{footer:a(()=>[c("div",le,[o(p,{onClick:t[5]||(t[5]=l=>e.formVisible=!1)},{default:a(()=>t[12]||(t[12]=[d("取消")])),_:1}),o(p,{type:"primary",onClick:N},{default:a(()=>t[13]||(t[13]=[d("确认")])),_:1})])]),default:a(()=>[o(D,{ref_key:"formRef",ref:_,rules:e.rules,"label-width":"80px",style:{padding:"20px 30px 0 0"},model:e.form},{default:a(()=>[e.user.role==="USER"?(n(),f(b,{key:0,label:"请假标题",prop:"title"},{default:a(()=>[o(s,{placeholder:"请输入f分类标题",modelValue:e.form.title,"onUpdate:modelValue":t[1]||(t[1]=l=>e.form.title=l),autocomplete:"off"},null,8,["modelValue"])]),_:1})):i("",!0),e.user.role==="USER"?(n(),f(b,{key:1,label:"请假说明",prop:"content"},{default:a(()=>[o(s,{type:"textarea",rows:3,placeholder:"请输入分类标题",modelValue:e.form.content,"onUpdate:modelValue":t[2]||(t[2]=l=>e.form.content=l),autocomplete:"off"},null,8,["modelValue"])]),_:1})):i("",!0),e.user.role==="ADMIN"?(n(),f(b,{key:2,label:"审核状态",prop:"status"},{default:a(()=>[o(z,{modelValue:e.form.status,"onUpdate:modelValue":t[3]||(t[3]=l=>e.form.status=l)},{default:a(()=>[o(w,{label:"审核通过",value:"审核通过"}),o(w,{label:"审核拒绝",value:"审核拒绝"})]),_:1},8,["modelValue"])]),_:1})):i("",!0),e.user.role==="ADMIN"&&e.form.status==="审核拒绝"?(n(),f(b,{key:3,label:"拒绝原因",prop:"reason"},{default:a(()=>[o(s,{modelValue:e.form.reason,"onUpdate:modelValue":t[4]||(t[4]=l=>e.form.reason=l),autocomplete:"off",placeholder:"请输入拒绝原因"},null,8,["modelValue"])]),_:1})):i("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),c("div",oe,[o(I,{data:e.tableData,style:{width:"100%"},onSelectionChange:r.handleSelectionChange,"header-cell-style":{color:"#333",fontSize:"17px",backgroundColor:"#eaf4ff"}},{default:a(()=>[o(m,{type:"selection",width:"55"}),o(m,{label:"请假标题",prop:"title"},{default:a(l=>[l.row.avatar?(n(),f(B,{key:0,src:l.row.avatar,"preview-src-list":[l.row.avatar],"preview-teleported":!0,style:{width:"40px",height:"40px","border-radius":"50%",display:"block"}},null,8,["src","preview-src-list"])):i("",!0)]),_:1}),o(m,{prop:"content",label:"请假内容"}),o(m,{prop:"userName",label:"请假人"}),o(m,{prop:"time",label:"请假时间"}),o(m,{prop:"status",label:"审核状态"},{default:a(l=>[l.row.status==="待审核"?(n(),f(V,{key:0,type:"warning"},{default:a(()=>t[14]||(t[14]=[d("待审核")])),_:1})):i("",!0),l.row.status==="审核拒绝"?(n(),f(V,{key:1,type:"danger"},{default:a(()=>t[15]||(t[15]=[d("审核拒绝")])),_:1})):i("",!0),l.row.status==="审核通过"?(n(),f(V,{key:2,type:"success"},{default:a(()=>t[16]||(t[16]=[d("审核通过")])),_:1})):i("",!0)]),_:1}),o(m,{prop:"reason",label:"审核说明"}),o(m,{label:"操作",width:"100"},W({_:2},[e.user.role==="USER"?{name:"default",fn:a(l=>[o(p,{disabled:l.row.status!=="待审核",circle:"",icon:"Edit",type:"primary",onClick:v=>k(l.row)},null,8,["disabled","onClick"]),o(p,{disabled:l.row.status!=="待审核",circle:"",icon:"Delete",type:"danger",onClick:v=>U(l.row.id)},null,8,["disabled","onClick"])]),key:"0"}:void 0,e.user.role==="ADMIN"?{name:"default",fn:a(l=>[o(p,{disabled:l.row.status!=="待审核",type:"primary",onClick:v=>k(l.row)},{default:a(()=>t[17]||(t[17]=[d("审核")])),_:2},1032,["disabled","onClick"])]),key:"1"}:void 0]),1024)]),_:1},8,["data","onSelectionChange"])]),c("div",ae,[o(A,{"current-page":e.pageNum,"onUpdate:currentPage":t[7]||(t[7]=l=>e.pageNum=l),"page-size":e.pageSize,"onUpdate:pageSize":t[8]||(t[8]=l=>e.pageSize=l),total:e.total,"page-sizes":[5,10,20],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:u,onSizeChange:u},null,8,["current-page","page-size","total"])])],64)}}};export{ke as default};
